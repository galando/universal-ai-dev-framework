---
description: PIV security rules for authentication and security code
globs: ["*Auth*", "*Security*", "*Password*", "*Token*", "*Credential*", "*Session*"]
alwaysApply: false
---

# Security Rules

## Golden Rule

**NEVER trust user input.**

Validate EVERYTHING: form submissions, API requests, file uploads, URL params, webhooks.

## SQL Injection Prevention

```javascript
// ❌ VULNERABLE - Never concatenate user input
const query = `SELECT * FROM users WHERE id = '${userId}'`;

// ✅ SECURE - Use parameterized queries
const query = 'SELECT * FROM users WHERE id = $1';
await db.query(query, [userId]);
```

## XSS Prevention

```javascript
// ❌ VULNERABLE - Never insert raw user input
div.innerHTML = userInput;

// ✅ SECURE - Use textContent or framework escaping
div.textContent = userInput;
```

## Authentication & Passwords

```javascript
// ❌ FORBIDDEN - Never use for passwords
MD5, SHA1, SHA256, SHA512

// ✅ REQUIRED - Use password hashing (bcrypt example)
import bcrypt from 'bcrypt';
const hash = await bcrypt.hash(password, 10);
const match = await bcrypt.compare(password, hash);
```

- Strong JWT secrets (256+ bits)
- Token expiration ≤1 hour
- Implement rate limiting on auth endpoints

## Data Protection

- ✅ HTTPS in production
- ✅ Encrypt sensitive data at rest
- ✅ Environment variables for secrets
- ❌ NEVER commit secrets to git
- ❌ NEVER log sensitive data
