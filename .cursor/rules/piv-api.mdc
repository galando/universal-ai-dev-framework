---
description: PIV API design rules for controllers and routes
globs: ["*Controller*", "*Router*", "*Route*", "routes/*", "controllers/*", "*Handler*"]
alwaysApply: false
---

# API Design Rules

## Workflow

1. **Write API test FIRST** (TDD applies to APIs too)
2. **Define request/response contract** before implementing
3. **Implement ONE endpoint** → test → confirm → then next

## RESTful Principles

- **Nouns over verbs**: `/users` not `/getUsers`
- **Plural nouns**: `/users` not `/user`
- **HTTP verbs**: GET (read), POST (create), PUT (update), DELETE (remove)
- **Resource hierarchy**: `/users/{id}/posts`

## Response Format

```json
// Success
{ "data": {...}, "meta": { "page": 1, "total": 100 } }

// Error
{ "error": "ValidationError", "message": "Email is required" }
```

## HTTP Methods & Status Codes

| Method | Purpose | Success Code |
|--------|---------|--------------|
| GET | Read resource | 200 |
| POST | Create resource | 201 |
| PUT | Update entire resource | 200 |
| PATCH | Partial update | 200 |
| DELETE | Remove resource | 204 |

| Error Code | Use Case |
|------------|----------|
| 400 | Bad Request (validation failed) |
| 401 | Unauthorized (not logged in) |
| 403 | Forbidden (no permission) |
| 404 | Not Found |
| 409 | Conflict (duplicate) |
| 500 | Server Error |

## Best Practices

- Validate all input (body, params, query)
- Version your API (`/v1/users`)
- Implement rate limiting on public endpoints
