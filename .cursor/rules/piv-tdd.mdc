---
description: PIV TDD enforcement for test files
globs: ["*.test.*", "*.spec.*", "__tests__/*", "test/*", "tests/*"]
alwaysApply: false
---

# TDD Requirements (MANDATORY)

**RED â†’ GREEN â†’ REFACTOR** - No exceptions.

## The Cycle (SEQUENTIAL - NO EXCEPTIONS)

| Phase | Action | Tool | Verify |
|-------|--------|------|--------|
| ðŸ”´ RED | Write failing test | `Write` / `StrReplace` | Run `Shell` â†’ see failure |
| ðŸŸ¢ GREEN | Write minimal implementation | `Write` / `StrReplace` | Run `Shell` â†’ see pass |
| ðŸ”µ REFACTOR | Improve code | `Write` / `StrReplace` | Run `Shell` â†’ still passes |

## Critical Rules

- âŒ **NEVER** write test and implementation in the same tool call
- âŒ **NEVER** skip running tests between phases
- âŒ **NEVER** create multiple files at once
- âœ… **ALWAYS** use `Shell` tool to run tests (e.g., `npm test`)
- âœ… **ALWAYS** use `Read` tool to check `package.json` for test command first
- âœ… **ALWAYS** verify test output before proceeding to next phase

## Checkpoints (ASK user before proceeding)

- After RED: "Test fails as expected. Proceed to GREEN phase?"
- After GREEN: "Test passes. Refactor or move to next test?"

## Test Structure (Given-When-Then)

```javascript
describe('UserService', () => {
  it('should create user with valid input', async () => {
    // GIVEN: Setup test data
    const input = { name: 'Test User', email: 'test@example.com' };

    // WHEN: Execute the code
    const result = await userService.create(input);

    // THEN: Verify outcomes
    expect(result.id).toBeDefined();
    expect(result.name).toBe('Test User');
  });
});
```
